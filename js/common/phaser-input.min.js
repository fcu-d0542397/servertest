/*!
 * phaser-input - version 2.0.5 
 * Adds input boxes to Phaser like CanvasInput, but also works for WebGL and Mobile, made for Phaser only.
 *
 * OrangeGames
 * Build at 02-06-2017
 * Released under MIT License 
 */

var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),PhaserInput;!function(t){var e;!function(t){t[t.text=0]="text",t[t.password=1]="password",t[t.number=2]="number"}(e=t.InputType||(t.InputType={}));var i=function(){function t(t,i,n,o,s,r){void 0===n&&(n=e.text),void 0===o&&(o="");var h=this;this.id=i,this.type=n,this.game=t,this.focusIn=s,this.focusOut=r;var p=this.game.canvas.getBoundingClientRect().top+document.body.scrollTop;this.element=document.createElement("input"),this.element.id=i,this.element.style.position="absolute",this.element.style.top=p+"px",this.element.style.left=(-40).toString()+"px",this.element.style.width=10..toString()+"px",this.element.style.height=10..toString()+"px",this.element.style.border="0px",this.element.value=this.value,this.element.type=e[n],this.element.addEventListener("focusin",function(){h.focusIn instanceof Phaser.Signal&&h.focusIn.dispatch()}),this.element.addEventListener("focusout",function(){h.focusOut instanceof Phaser.Signal&&h.focusOut.dispatch()}),document.body.appendChild(this.element)}return t.prototype.addKeyUpListener=function(t){this.keyUpCallback=t,document.addEventListener("keyup",this.keyUpCallback),this.element.addEventListener("input",this.keyUpCallback)},t.prototype.blockKeyDownEvents=function(){document.addEventListener("keydown",this.preventKeyPropagation)},t.prototype.preventKeyPropagation=function(t){t.stopPropagation?t.stopPropagation():event.cancelBubble=!0},t.prototype.unblockKeyDownEvents=function(){document.removeEventListener("keydown",this.preventKeyPropagation)},t.prototype.removeEventListener=function(){document.removeEventListener("keyup",this.keyUpCallback),this.element.removeEventListener("input",this.keyUpCallback)},t.prototype.destroy=function(){document.body.removeChild(this.element)},t.prototype.setMax=function(t,i){if(void 0!==t)if(this.type===e.text||this.type===e.password)this.element.maxLength=parseInt(t,10);else if(this.type===e.number){if(this.element.max=t,void 0===i)return;this.element.min=i}},Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!0,configurable:!0}),t.prototype.focus=function(){var t=this;if(this.element.focus(),!this.game.device.desktop&&this.game.device.chrome)var e=window.innerWidth,i=window.innerHeight,n=!1,o=setInterval(function(){(e>window.innerWidth||i>window.innerHeight)&&(n=!0),n&&e===window.innerWidth&&i===window.innerHeight&&(t.focusOut instanceof Phaser.Signal&&t.focusOut.dispatch(),clearInterval(o))},50)},t.prototype.blur=function(){this.element.blur()},Object.defineProperty(t.prototype,"hasSelection",{get:function(){return this.type!==e.number&&this.element.selectionStart!==this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretStart",{get:function(){return this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretEnd",{get:function(){return this.element.selectionStart},enumerable:!0,configurable:!0}),t.prototype.getCaretPosition=function(){return this.type===e.number?-1:this.element.selectionStart},t.prototype.setCaretPosition=function(t){this.type!==e.number&&this.element.setSelectionRange(t,t)},t}();t.InputElement=i}(PhaserInput||(PhaserInput={}));var PhaserInput;!function(t){var e;!function(t){t[t.none=0]="none",t[t.lower=1]="lower",t[t.upper=2]="upper"}(e=t.ForceCase||(t.ForceCase={}));var i=function(i){function n(n,o,s,r){void 0===r&&(r={});var h=i.call(this,n,o,s)||this;return h.focusOutOnEnter=!0,h.placeHolder=null,h.box=null,h.focus=!1,h.value="",h.windowScale=1,h.blockInput=!0,h.focusIn=new Phaser.Signal,h.focusOut=new Phaser.Signal,h.blink=!0,h.cnt=0,h.inputOptions=r,h.inputOptions.width="number"==typeof r.width?r.width:150,h.inputOptions.padding="number"==typeof r.padding?r.padding:0,h.inputOptions.textAlign=r.textAlign||"left",h.inputOptions.type=r.type||t.InputType.text,h.inputOptions.forceCase=r.forceCase?r.forceCase:e.none,h.inputOptions.borderRadius="number"==typeof r.borderRadius?r.borderRadius:0,h.inputOptions.height="number"==typeof r.height?r.height:14,h.inputOptions.fillAlpha=void 0===r.fillAlpha?1:r.fillAlpha,h.inputOptions.selectionColor=r.selectionColor||"rgba(179, 212, 253, 0.8)",h.inputOptions.zoom=!n.device.desktop&&(r.zoom||!1),h.box=new t.InputBox(h.game,r),h.setTexture(h.box.generateTexture()),h.textMask=new t.TextMask(h.game,r),h.addChild(h.textMask),h.domElement=new t.InputElement(h.game,"phaser-input-"+(1e4*Math.random()|0).toString(),h.inputOptions.type,h.value,h.focusIn,h.focusOut),h.domElement.setMax(h.inputOptions.max,h.inputOptions.min),h.selection=new t.SelectionHighlight(h.game,h.inputOptions),h.selection.mask=h.textMask,h.addChild(h.selection),r.placeHolder&&r.placeHolder.length>0&&(h.placeHolder=new Phaser.Text(n,h.inputOptions.padding,h.inputOptions.padding,r.placeHolder,{font:r.font||"14px Arial",fontWeight:r.fontWeight||"normal",fill:r.placeHolderColor||"#bfbebd"}),h.placeHolder.mask=h.textMask,h.addChild(h.placeHolder)),h.cursor=new Phaser.Text(n,h.inputOptions.padding,h.inputOptions.padding-2,"|",{font:r.font||"14px Arial",fontWeight:r.fontWeight||"normal",fill:r.cursorColor||"#000000"}),h.cursor.visible=!1,h.addChild(h.cursor),h.text=new Phaser.Text(n,h.inputOptions.padding,h.inputOptions.padding,"",{font:r.font||"14px Arial",fontWeight:r.fontWeight||"normal",fill:r.fill||"#000000"}),h.text.mask=h.textMask,h.addChild(h.text),h.offscreenText=new Phaser.Text(n,h.inputOptions.padding,h.inputOptions.padding,"",{font:r.font||"14px Arial",fontWeight:r.fontWeight||"normal",fill:r.fill||"#000000"}),h.updateTextAlignment(),h.inputEnabled=!0,h.input.useHandCursor=!0,h.game.input.onDown.add(h.checkDown,h),h.focusOut.add(function(){t.KeyboardOpen&&(h.endFocus(),h.inputOptions.zoom&&h.zoomOut())}),h}return __extends(n,i),Object.defineProperty(n.prototype,"width",{get:function(){return this.inputOptions.width},set:function(t){this.inputOptions.width=t,this.box.resize(t),this.textMask.resize(t),this.updateTextAlignment()},enumerable:!0,configurable:!0}),n.prototype.updateTextAlignment=function(){switch(this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.text.x=this.inputOptions.padding,null!==this.placeHolder&&this.placeHolder.anchor.set(0,0),this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.padding+this.inputOptions.width/2,null!==this.placeHolder&&(this.placeHolder.anchor.set(.5,0),this.placeHolder.x=this.inputOptions.padding+this.inputOptions.width/2),this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition();break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.padding+this.inputOptions.width,null!==this.placeHolder&&(this.placeHolder.anchor.set(1,0),this.placeHolder.x=this.inputOptions.padding+this.inputOptions.width),this.cursor.x=this.inputOptions.padding+this.inputOptions.width}},n.prototype.checkDown=function(e){if(this.value||this.resetText(),this.input.checkPointerOver(e)){if(this.focus)return void this.setCaretOnclick(e);this.inputOptions.zoom&&!t.Zoomed&&this.zoomIn(),this.startFocus()}else!0===this.focus&&(this.endFocus(),this.inputOptions.zoom&&this.zoomOut())},n.prototype.update=function(){if(this.text.update(),this.placeHolder&&this.placeHolder.update(),this.focus){if(30!==this.cnt)return this.cnt++;this.cursor.visible=this.blink,this.blink=!this.blink,this.cnt=0}},n.prototype.endFocus=function(){var e=this;this.focus&&(this.domElement.removeEventListener(),!0===this.blockInput&&this.domElement.unblockKeyDownEvents(),this.focus=!1,0===this.value.length&&null!==this.placeHolder&&(this.placeHolder.visible=!0),this.cursor.visible=!1,this.game.device.desktop?setTimeout(function(){e.domElement.blur()},0):this.domElement.blur(),this.game.device.desktop||(t.KeyboardOpen=!1,t.onKeyboardClose.dispatch()))},n.prototype.startFocus=function(){var e=this;this.focus=!0,null!==this.placeHolder&&(this.placeHolder.visible=!1),this.game.device.desktop?setTimeout(function(){e.keyUpProcessor()},0):this.keyUpProcessor(),this.game.device.desktop||(t.KeyboardOpen=!0,t.onKeyboardOpen.dispatch())},n.prototype.keyUpProcessor=function(){this.domElement.addKeyUpListener(this.keyListener.bind(this)),this.domElement.focus(),!0===this.blockInput&&this.domElement.blockKeyDownEvents()},n.prototype.updateText=function(){var e="";if(this.inputOptions.type===t.InputType.password)for(var i=0;i<this.value.length;i++)e+="*";else if(this.inputOptions.type===t.InputType.number){var n=parseInt(this.value);e=n<parseInt(this.inputOptions.min)?this.value=this.domElement.value=this.inputOptions.min:n>parseInt(this.inputOptions.max)?this.value=this.domElement.value=this.inputOptions.max:this.value}else e=this.value;if(this.text.setText(e),this.text.width>this.inputOptions.width)this.text.anchor.x=1,this.text.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.text.x=this.inputOptions.padding;break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.padding+this.inputOptions.width/2;break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.padding+this.inputOptions.width}},n.prototype.updateCursor=function(){if(this.text.width>this.inputOptions.width||"right"===this.inputOptions.textAlign)this.cursor.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition()}},n.prototype.getCaretPosition=function(){var e=this.domElement.getCaretPosition();if(-1===e)return this.text.width;var i=this.value;if(this.inputOptions.type===t.InputType.password){i="";for(var n=0;n<this.value.length;n++)i+="*"}return this.offscreenText.setText(i.slice(0,e)),this.offscreenText.width},n.prototype.setCaretOnclick=function(t){var e=this.text.toLocal(new PIXI.Point(t.x,t.y),this.game.world).x;this.inputOptions.textAlign&&"center"===this.inputOptions.textAlign&&(e+=this.text.width/2);for(var i=this.text.width/this.value.length,n=0,o=0;o<this.value.length;o++)if(e>=o*i&&(o+1)*i>=e){n=o;break}e>(this.value.length-1)*i&&(n=this.value.length),this.startFocus(),this.domElement.setCaretPosition(n),this.updateCursor()},n.prototype.updateSelection=function(){if(this.domElement.hasSelection){var e=this.value;if(this.inputOptions.type===t.InputType.password){e="";for(var i=0;i<this.value.length;i++)e+="*"}switch(e=e.substring(this.domElement.caretStart,this.domElement.caretEnd),this.offscreenText.setText(e),this.selection.updateSelection(this.offscreenText.getBounds()),this.inputOptions.textAlign){case"left":this.selection.x=this.inputOptions.padding;break;case"center":this.selection.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2}}else this.selection.clear()},n.prototype.zoomIn=function(){if(!t.Zoomed){var e=this.getBounds();window.innerHeight>window.innerWidth?this.windowScale=this.game.width/(1.5*e.width):this.windowScale=this.game.width/2/(1.5*e.width);var i=(this.game.width-1.5*e.width)/2/this.windowScale;this.game.world.scale.set(this.game.world.scale.x*this.windowScale,this.game.world.scale.y*this.windowScale),this.game.world.pivot.set(e.x-i,e.y-2*this.inputOptions.padding),t.Zoomed=!0}},n.prototype.zoomOut=function(){t.Zoomed&&(this.game.world.scale.set(this.game.world.scale.x/this.windowScale,this.game.world.scale.y/this.windowScale),this.game.world.pivot.set(0,0),t.Zoomed=!1)},n.prototype.keyListener=function(t){return this.value=this.getFormattedText(this.domElement.value),13===t.keyCode?void(this.focusOutOnEnter&&this.endFocus()):(this.updateText(),this.updateCursor(),this.updateSelection(),void t.preventDefault())},n.prototype.destroy=function(t){this.game.input.onDown.remove(this.checkDown,this),this.focusIn.removeAll(),this.focusOut.removeAll(),this.domElement.destroy(),i.prototype.destroy.call(this,t)},n.prototype.resetText=function(){this.setText()},n.prototype.setText=function(t){void 0===t&&(t=""),null!==this.placeHolder&&(t.length>0?this.placeHolder.visible=!1:this.placeHolder.visible=!0),this.value=this.getFormattedText(t),this.domElement.value=this.value,this.updateText(),this.updateCursor(),this.endFocus()},n.prototype.getFormattedText=function(t){switch(this.inputOptions.forceCase){default:case e.none:return t;case e.lower:return t.toLowerCase();case e.upper:return t.toUpperCase()}},n}(Phaser.Sprite);t.InputField=i}(PhaserInput||(PhaserInput={}));var PhaserInput;!function(t){var e=function(t){function e(e,i){var n=t.call(this,e,0,0)||this;n.bgColor=i.backgroundColor?parseInt(i.backgroundColor.slice(1),16):16777215,n.borderRadius=i.borderRadius||0,n.borderWidth=i.borderWidth||1,n.borderColor=i.borderColor?parseInt(i.borderColor.slice(1),16):9803157,n.boxAlpha=i.fillAlpha,n.padding=i.padding;var o,o=i.height,s=i.width;i.font&&(o=Math.max(parseInt(i.font.substr(0,i.font.indexOf("px")),10),o)),n.boxHeight=2*n.padding+o;var s=i.width;return n.boxWidth=2*n.padding+s,n.drawBox(),n}return __extends(e,t),e.prototype.resize=function(t){this.boxWidth=2*this.padding+t,this.drawBox()},e.prototype.drawBox=function(){this.clear().beginFill(this.bgColor,this.boxAlpha).lineStyle(this.borderWidth,this.borderColor,this.boxAlpha),this.borderRadius>0?this.drawRoundedRect(0,0,this.boxWidth,this.boxHeight,this.borderRadius):this.drawRect(0,0,this.boxWidth,this.boxHeight)},e}(Phaser.Graphics);t.InputBox=e}(PhaserInput||(PhaserInput={}));var PhaserInput;!function(t){var e=function(t){function e(e,i){var n=t.call(this,e,i.padding,i.padding)||this;return n.inputOptions=i,n}return __extends(e,t),e.prototype.updateSelection=function(t){var i=Phaser.Color.webToColor(this.inputOptions.selectionColor);this.clear(),this.beginFill(e.rgb2hex(i),i.a),this.drawRect(t.x,t.y,t.width,t.height-this.inputOptions.padding)},e.rgb2hex=function(t){return parseInt(("0"+t.r.toString(16)).slice(-2)+("0"+t.g.toString(16)).slice(-2)+("0"+t.b.toString(16)).slice(-2),16)},e}(Phaser.Graphics);t.SelectionHighlight=e}(PhaserInput||(PhaserInput={}));var PhaserInput;!function(t){var e=function(t){function e(e,i){var n=t.call(this,e,i.padding,i.padding)||this,o=i.height;return i.font&&(o=Math.max(parseInt(i.font.substr(0,i.font.indexOf("px")),10),o)),n.maskWidth=i.width,n.maskHeight=1.3*o,n.drawMask(),n}return __extends(e,t),e.prototype.resize=function(t){this.maskWidth=t,this.drawMask()},e.prototype.drawMask=function(){this.clear().beginFill(0).drawRect(0,0,this.maskWidth,this.maskHeight).endFill()},e}(Phaser.Graphics);t.TextMask=e}(PhaserInput||(PhaserInput={}));var PhaserInput;!function(t){t.Zoomed=!1,t.KeyboardOpen=!1,t.onKeyboardOpen=new Phaser.Signal,t.onKeyboardClose=new Phaser.Signal;var e=function(e){function i(t,i){var n=e.call(this,t,i)||this;return n.addInputFieldFactory(),n}return __extends(i,e),i.prototype.addInputFieldFactory=function(){Phaser.GameObjectFactory.prototype.inputField=function(e,i,n,o){void 0===o&&(o=this.world);var s=new t.InputField(this.game,e,i,n);return o.add(s)},Phaser.GameObjectCreator.prototype.inputField=function(e,i,n){return new t.InputField(this.game,e,i,n)}},i}(Phaser.Plugin);e.Zoomed=!1,e.KeyboardOpen=!1,e.onKeyboardOpen=new Phaser.Signal,e.onKeyboardClose=new Phaser.Signal,t.Plugin=e}(PhaserInput||(PhaserInput={}));